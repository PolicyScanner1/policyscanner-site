<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PolicyScanner | Home Insurance Cover Match</title>
  <style>
    body {
      font-family: "Inter", system-ui, sans-serif;
      margin: 0;
      background: #f8fafc;
      color: #0f172a;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1.2rem 3rem;
      background: #ffffffcc;
      backdrop-filter: blur(12px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    header h1 { font-size: 1.4rem; font-weight: 700; color: #2563eb; }
    nav a { margin-left: 1.5rem; color: #334155; text-decoration: none; font-weight: 500; }
    nav a:hover { color: #1d4ed8; }

    /* Hero */
    .hero {
      padding: 3rem 2rem 2.5rem;
      background: linear-gradient(135deg, #2563eb, #1e3a8a);
      color: white;
      text-align: center;
    }
    .hero-content { max-width: 680px; margin: 0 auto 2.5rem; animation: fadeIn 1.2s ease; }
    .hero h2 { font-size: 2rem; margin-bottom: 0.8rem; }
    .hero p { color: #dbeafe; font-size: 1.05rem; line-height: 1.6; }
    .hero button {
      margin-top: 1rem;
      background: white;
      color: #1e3a8a;
      border: none;
      padding: 0.75rem 1.4rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s ease;
    }
    .hero button:hover { background: #e2e8f0; transform: translateY(-1px); }

    .feature-row {
      display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;
      max-width: 900px; margin: 0 auto;
    }
    .feature {
      background: rgba(255,255,255,0.12); backdrop-filter: blur(10px);
      border-radius: 12px; padding: 1rem 1.2rem; flex: 1;
      min-width: 220px; max-width: 280px; text-align: center; color: #f1f5f9;
    }
    .feature span { font-size: 1.8rem; display: block; margin-bottom: 0.3rem; }

    /* Upload */
    .container { display: flex; justify-content: center; margin-top: -1.5rem; padding: 2rem; }
    .card { background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); padding: 2rem; max-width: 950px; width: 100%; }
    .upload-area { text-align: center; margin-bottom: 1.5rem; }

    .custom-file-upload {
      background: #2563eb; color: white; padding: 0.8rem 1.4rem;
      border-radius: 8px; font-weight: 600; display: inline-block; cursor: pointer;
      transition: background 0.2s ease; margin-right: 0.5rem;
    }
    .custom-file-upload:hover { background: #1d4ed8; }
    input[type="file"] { display: none; }

    button.upload {
      background: #1e3a8a; color: white; border: none; padding: 0.8rem 1.4rem;
      border-radius: 8px; font-weight: 600; cursor: pointer;
    }
    button.upload:hover { background: #172554; }

    /* Sections */
    .section { background: #f1f5f9; border-radius: 12px; padding: 1.5rem; margin: 1rem 0; }
    .section h4 {
      color: #1e3a8a; margin-bottom: 0.6rem; border-bottom: 2px solid #2563eb;
      display: inline-block; padding-bottom: 0.2rem;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { padding: 0.6rem 0.5rem; border: 1px solid #e2e8f0; text-align: left; }
    th { background: #f8fafc; color: #1e3a8a; }
    td:first-child { font-weight: 500; color: #334155; }

    ul { margin: 0.4rem 0 0.6rem 1.2rem; color: #0f172a; }
    .section b { display: block; margin-top: 1rem; margin-bottom: 0.3rem; font-weight: 600; color: #1e3a8a; }
    .section table + b { border-top: 2px solid #bfdbfe; padding-top: 0.8rem; margin-top: 1.2rem; }

    /* Loader */
    .loader {
      border: 4px solid #e2e8f0;
      border-top: 4px solid #2563eb;
      border-radius: 50%;
      width: 55px; height: 55px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* Modal */
    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(15,23,42,0.45);
      display: none; align-items: center; justify-content: center; padding: 1rem; z-index: 50;
    }
    .modal { background: #fff; border-radius: 14px; width: 100%; max-width: 480px; box-shadow: 0 20px 60px rgba(0,0,0,0.25); overflow: hidden; }
    .modal-header { background: linear-gradient(135deg,#2563eb,#1e3a8a); color: #fff; padding: 1rem 1.2rem; display: flex; justify-content: space-between; align-items:center; }
    .close-btn { background: transparent; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; }
    .modal-body { padding: 1.2rem; }
    .input { width: 100%; border: 1px solid #e5e7eb; border-radius: 10px; padding: .7rem .9rem; font-size: 1rem; }
    .submit-btn { margin-top: .6rem; background: #2563eb; color: #fff; border: none; border-radius: 10px; padding: .75rem 1rem; font-weight: 700; cursor: pointer; width: 100%; }

    footer { text-align: center; padding: 2rem; background: #1e293b; color: #cbd5e1; font-size: 0.9rem; }
  </style>
</head>

<body>
  <header>
    <h1>PolicyScanner</h1>
    <nav>
      <a href="#demo">Compare</a>
      <a href="mailto:hello@policyscanner.co.uk">Contact</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-content">
      <h2>Smarter Home Insurance Comparison</h2>
      <p>Upload your renewal document to instantly see how your cover, excesses, and premiums compare ‚Äî all structured for clarity and accuracy.</p>
      <button onclick="document.getElementById('upload-section').scrollIntoView({behavior:'smooth'})">Try it now ‚Üì</button>
    </div>

    <div class="feature-row">
      <div class="feature"><span>‚ö°</span><h4>Instant Results</h4><p>See your policy breakdown in seconds using AI-powered document parsing.</p></div>
      <div class="feature"><span>üîç</span><h4>Cover Transparency</h4><p>Compare buildings and contents cover line-by-line for true clarity.</p></div>
      <div class="feature"><span>ü§ù</span><h4>Trusted Insights</h4><p>Built to help homeowners make confident, data-driven decisions.</p></div>
    </div>
  </section>

  <div class="container" id="upload-section">
    <div class="card">
      <div class="upload-area">
        <label for="fileInput" class="custom-file-upload">üìÑ Choose File</label>
        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" />
        <button class="upload" onclick="uploadFile()">Upload & Analyse</button>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <footer>¬© 2025 PolicyScanner ‚Äî Building trust in insurance through transparency.</footer>

  <!-- Waitlist Modal -->
  <div id="waitlistBackdrop" class="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <h3 id="waitlistTitle">Join Early Access</h3>
        <button class="close-btn" onclick="closeWaitlist()">√ó</button>
      </div>
      <div class="modal-body">
        <p id="waitlistSubtitle">Enter your email to be notified when this feature goes live.</p>
        <form id="waitlistForm">
          <input type="hidden" id="featureField" name="feature" />
          <input type="email" id="waitlistEmail" name="email" placeholder="you@example.com" required class="input" />
          <button type="submit" class="submit-btn">Join Waitlist</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    const money = v => v ? `¬£${Number(v).toLocaleString()}` : "N/A";

    function showLoader() {
      const result = document.getElementById("result");
      result.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:3rem 0;color:#1e3a8a;">
          <div class="loader"></div>
          <p style="margin-top:1rem;font-weight:600;">Analysing your document‚Ä¶</p>
          <p style="color:#64748b;font-size:.9rem;">Extracting cover details securely</p>
        </div>`;
    }

    async function uploadFile() {
      const f = document.getElementById("fileInput").files[0];
      const result = document.getElementById("result");
      if (!f) return alert("Please select a file first.");
      showLoader();

      const fd = new FormData();
      fd.append("file", f);

      try {
        const res = await fetch("https://policyscanner-backend.onrender.com/upload", { method: "POST", body: fd });
        const d = await res.json();
        result.innerHTML = render(d);
      } catch (e) {
        result.innerHTML = `<span style='color:red'>Error: ${e.message}</span>`;
      }
    }

    function render(d) {
      return `
        <div class="section">
          <h4>üìã Policy Summary</h4>
          <table>
            <tr><td>Policyholder</td><td>${d.policyholder_name || "N/A"}</td></tr>
            <tr><td>Insurer</td><td>${d.insurer_name || "N/A"}</td></tr>
            <tr><td>Policy Number</td><td>${d.policy_number || "N/A"}</td></tr>
            <tr><td>Start Date</td><td>${d.start_date || "N/A"}</td></tr>
            <tr><td>End Date</td><td>${d.end_date || "N/A"}</td></tr>
            <tr><td>Renewal Premium</td><td>${money(d.renewal_premium)}</td></tr>
          </table>
        </div>

        <div class="section">
          <h4>üè† Property Details</h4>
          <table>
            <tr><td>Address</td><td>${d.address || "N/A"}</td></tr>
            <tr><td>Postcode</td><td>${d.postcode || "N/A"}</td></tr>
            <tr><td>Type</td><td>${d.property_type || "N/A"}</td></tr>
            <tr><td>Bedrooms</td><td>${d.bedrooms || "N/A"}</td></tr>
            <tr><td>Bathrooms</td><td>${d.bathrooms || "N/A"}</td></tr>
            <tr><td>Year Built</td><td>${d.year_built || "N/A"}</td></tr>
            <tr><td>Construction</td><td>${d.construction_type || "N/A"}</td></tr>
            <tr><td>Roof Type</td><td>${d.roof_type || "N/A"}</td></tr>
            <tr><td>Flat Roof %</td><td>${d.flat_roof_percentage || "N/A"}</td></tr>
            <tr><td>Listed Status</td><td>${d.listed_status || "N/A"}</td></tr>
          </table>
        </div>

        <div class="section">
          <h4>üíº Cover Details</h4>
          <table>
            <tr><td>Buildings Sum Insured</td><td>${money(d.buildings_sum_insured)}</td></tr>
            <tr><td>Contents Sum Insured</td><td>${money(d.contents_sum_insured)}</td></tr>
            <tr><td>Accidental Damage (Buildings)</td><td>${d.accidental_damage_buildings || d.accidental_damage_cover || "N/A"}</td></tr>
            <tr><td>Accidental Damage (Contents)</td><td>${d.accidental_damage_contents || d.accidental_damage_cover || "N/A"}</td></tr>
            <tr><td>Legal Expenses</td><td>${d.legal_expenses_cover || "N/A"}</td></tr>
            <tr><td>Personal Possessions</td><td>${d.personal_possessions_cover || "N/A"}</td></tr>
            <tr><td>Home Emergency</td><td>${d.home_emergency_cover || "N/A"}</td></tr>
          </table>
        </div>

        <div class="section">
          <h4>üí∞ Financials & Excesses</h4>
          <table>
            <tr><th></th><th>Buildings</th><th>Contents</th></tr>
            <tr><td>Voluntary Excess</td><td>${money(d.excess_buildings_voluntary || d.excess_voluntary)}</td><td>${money(d.excess_contents_voluntary || d.excess_voluntary)}</td></tr>
            <tr><td>Compulsory Excess</td><td>${money(d.excess_buildings_compulsory || d.excess_standard)}</td><td>${money(d.excess_contents_compulsory || d.excess_standard)}</td></tr>
          </table>
          <b>No Claims Discount:</b>
          <table>
            <tr><th></th><th>Buildings</th><th>Contents</th></tr>
            <tr><td>Years</td><td>${d.no_claims_discount_buildings_years || "N/A"}</td><td>${d.no_claims_discount_contents_years || "N/A"}</td></tr>
          </table>
          <b>Previous Claims:</b>
          ${Array.isArray(d.previous_claims) && d.previous_claims.length ? `
            <table><tr><th>Date</th><th>Type</th><th>Amount</th></tr>
            ${d.previous_claims.map(c => `<tr><td>${c.date}</td><td>${c.type}</td><td>${money(c.amount)}</td></tr>`).join("")}</table>
          ` : "None reported."}
        </div>

        <div class="section">
          <h4>‚ö†Ô∏è Endorsements & Exclusions</h4>
          <b>Specified Items:</b>
          ${Array.isArray(d.specified_items) && d.specified_items.length ? `
            <table><tr><th>Item</th><th>Value</th><th>Covered Away From Home</th></tr>
            ${d.specified_items.map(i => `<tr><td>${i.item}</td><td>${money(i.value)}</td><td>${i.away_from_home || "N/A"}</td></tr>`).join("")}</table>
          ` : "None listed."}
          <b>Endorsements:</b>
          ${Array.isArray(d.endorsements) && d.endorsements.length ? `<ul>${d.endorsements.map(e => `<li
${d.endorsements.map(e => `<li>${e}</li>`).join("")}</ul>` : "None."}

          <b>Exclusions:</b>
          ${Array.isArray(d.exclusions) && d.exclusions.length 
            ? `<ul>${d.exclusions.map(e => `<li>${e}</li>`).join("")}</ul>` 
            : "None."}
        </div>

        <div class="next-steps">
          <h4>üöÄ Next Steps</h4>
          <p>Ready to take control of your home insurance?</p>
          <a class="btn btn-primary" href="#" onclick="openWaitlist('Compare Your Renewal')">Compare Your Renewal (Coming Soon)</a>
          <a class="btn btn-secondary" href="#" onclick="openWaitlist('Get a New Quote')">Get a New Quote (Coming Soon)</a>
        </div>
      `;
    }

    // === Modal logic for waitlist ===
    const backdrop = document.getElementById("waitlistBackdrop");
    const form = document.getElementById("waitlistForm");
    const featureField = document.getElementById("featureField");

    function openWaitlist(featureName) {
      featureField.value = featureName;
      backdrop.style.display = "flex";
    }
    function closeWaitlist() {
      backdrop.style.display = "none";
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      try {
        await fetch("https://formspree.io/f/xgvpelrd", {
          method: "POST",
          body: data,
          headers: { Accept: "application/json" }
        });
        document.getElementById("waitlistTitle").innerText = "You're on the list! üéâ";
        document.getElementById("waitlistSubtitle").innerText = "We‚Äôll email you when this feature is live.";
        form.style.display = "none";
      } catch {
        alert("Something went wrong ‚Äî please try again.");
      }
    });
  </script>
</body>
</html>
