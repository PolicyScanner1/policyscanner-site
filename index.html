<script>
async function uploadFile() {
  const fileInput = document.getElementById("fileInput");
  const resultDiv = document.getElementById("result");
  const file = fileInput.files[0];
  if (!file) return alert("Please select a file first.");

  resultDiv.innerHTML = "<em>Processing your document...</em> ‚è≥";

  const formData = new FormData();
  formData.append("file", file);

  try {
    const response = await fetch("https://policyscanner-backend.onrender.com/upload", {
      method: "POST",
      body: formData,
    });

    if (!response.ok) throw new Error("Upload failed.");

    const data = await response.json();
    console.log("Parsed JSON:", data); // helpful for debugging

    // Clear previous result
    resultDiv.innerHTML = "";

    // Pretty-print every field dynamically
    const entries = Object.entries(data);
    if (!entries.length) {
      resultDiv.innerHTML = "<div class='error'>No data found in response.</div>";
      return;
    }

    resultDiv.innerHTML = `<h3>Extracted Policy Details</h3>`;

    entries.forEach(([key, value]) => {
      if (typeof value === "object" && value !== null) {
        resultDiv.innerHTML += `<p><strong>${key}</strong>:<br><pre>${JSON.stringify(value, null, 2)}</pre></p>`;
      } else {
        resultDiv.innerHTML += `<p><strong>${key}</strong>: ${value ?? "N/A"}</p>`;
      }
    });

  } catch (err) {
    resultDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
  }
}
</script>
